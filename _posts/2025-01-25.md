## Enhancing Wazuh Rule Testing with wazuhevtx: A Solution for Windows Event Logs

Wazuh's powerful log analysis and rule engine enables organizations to monitor and respond to a wide range of security events. For Wazuh users, fine-tuning and testing custom rules and decoders is a crucial part of the process. This is where the wazuh-logtest tool shines—providing a sandboxed environment to validate and refine rules against sample logs.

However, when it comes to Windows event logs, wazuh-logtest presents a unique challenge. In this article, we’ll explore the problem and introduce wazuhevtx, a tool designed to bridge the gap and bring seamless rule testing for Windows event logs to the Wazuh ecosystem.

### Section 1: Rule Testing with wazuh-logtest

The wazuh-logtest tool is an interactive utility that enables users to test rules and decoders in isolation. It allows you to paste sample logs, view their processing lifecycle, and observe which rules match. This three-phase process—pre-decoding, decoding, and filtering—helps users debug decoders, refine rules, and validate expected behaviors.

#### How wazuh-logtest Works

1. **Launch the Tool:** Run wazuh-logtest interactively:

```bash
/var/ossec/bin/wazuh-logtest
```

2. **Paste a Log:** Provide a sample log in the required format. For example:

```plaintext
Oct 15 21:07:00 linux-agent sshd[29205]: Invalid user blimey from 18.18.18.18 port 48928
```

3. **Analyze the Output:** The tool processes the log in three phases

  Phase 1: Pre-Decoding—Extracts metadata such as hostname, program_name, and timestamp.
  Phase 2: Decoding—Matches decoders and extracts specific fields (e.g., srcip, srcuser).
  Phase 3: Filtering—Applies Wazuh rules, displaying matched rule IDs, descriptions, and metadata.

This process makes wazuh-logtest invaluable for testing and debugging custom rules—except when dealing with Windows event logs.

#### The Problem with Windows Event Logs

Unlike typical logs, Windows event logs are structured, binary files that bypass standard decoders. Instead, the Wazuh agent uses a specialized C library to process these logs locally before sending them to the manager[^1]. As a result:

* Windows event logs cannot be tested directly in wazuh-logtest.
* Users are unable to paste raw event data or verify rules against Windows logs in the same way they do with syslog or audit logs.

This limitation leaves a critical gap for Wazuh users who need to validate rules for Windows event channels like Sysmon or Security-Auditing.

### Section 2: The Solution—Introducing wazuhevtx

To address this challenge, we developed wazuhevtx, a Python tool that converts Windows event logs (EVTX) into JSON formatted logs that mimic the output of the Wazuh agent. This allows users to test Windows event logs interactively with wazuh-logtest.

#### What Does wazuhevtx Do?

wazuhevtx:

* Reads binary EVTX files from Windows systems.
* Converts events into structured JSON logs, formatted as the Wazuh agent would send them.
* Supports standardized fields like win.system and win.eventdata, ensuring compatibility with Wazuh rules and decoders.
* Enables seamless rule testing in wazuh-logtest.

By bridging the gap between EVTX logs and Wazuh's rule testing capabilities, wazuhevtx empowers users to validate and fine-tune rules for Windows event logs.

#### How to Use wazuhevtx

##### Step 1: Install the Tool

You can use `pip` or clone the repository. If you want to use it both as a library and a CLI tool, install the module using `pipx install https://github.com/zbalkan/wazuhevtx/archive/refs/heads/main.zip`, after you created a virtual environment of your preference.

If you plan to use it only as a CLI tool, I recommend using `pipx` instead.

##### Step 2: Prepare Wazuh server for testing

> Explain

##### Step 3: Convert EVTX Logs to JSON

Run the wazuhevtx tool with your EVTX file as input:

```bash
python wazuhevtx.py sample.evtx -o sample.json
```

##### Step 4: Test Logs in wazuh-logtest

1. Launch wazuh-logtest:

```bash
/var/ossec/bin/wazuh-logtest
```

2. Copy a single JSON log from the output file (sample.json) and paste it into the wazuh-logtest terminal:

```json
{ "win": { "system": { "providerName": "Microsoft-Windows-Sysmon", "eventID": "1", "severityValue": "INFORMATION", "computer": "LABPC"},"eventdata": {"ruleName": "technique_id=T1083,technique_name=File and Directory Discovery", "image": "C:\\Program Files\\Mozilla Firefox\\firefox.exe","user": "LABPC\\Zafer"}}}
```

3. Observe the output:

Check matched rules, extracted fields, and compliance mappings.

#### Why Use `wazuhevtx`?

The reason is mentioned in the introduction. We are complementing the log testing capability of Wazuh, and Event Logs were an edge case. You can now replay known attacks. But there are caveats and we can see them live.

Let's give it a shot with amazing [EVTX-ATTACK-SAMPLES](https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES) repository by [Samir Bousseaden](https://x.com/sbousseaden).

> Add screenshot of repository
> Pick an attack
> Check the logs

### Conclusion

`wazuh-logtest` is a very minimal but usable tool for Wazuh users to test and refine custom rules, but its limitation with Windows event logs has long been a challenge. With `wazuhevtx`, you now have the ability to convert EVTX files into Wazuh-compatible JSON logs, enabling comprehensive rule testing for Windows events.

Get the Tool: [wazuhevtx GitHub Repository](https://github.com/zbalkan/wazuhevtx)

### P.S

This tool requires manual interaction with Wazug-logtest tool as the tool resides on Wazuh manager nodes of your -hopefully- test environment. You may need to automate this in the long run. I have another tool that I have been developing for that. It will be another article's topic.

---

[^1] As a side note, this is valid for 4.x versions and earlier. Upcoming version, Wazuh 5.0 may not need it.
